<mat-card>
  <mat-card-header>
    <mat-card-title>
      Revisión de Documentos
    </mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <p *ngIf="mensaje">{{mensaje}}</p>
    <mat-card *ngIf="modo === 'DOCENTE' && !mensaje">
      <mat-card-header>
        <mat-card-title>
          Trabajos de grado asociados
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-form-field style="width: 100%;">
          <mat-label>Trabajo de Grado</mat-label>
          <mat-select [(ngModel)]="trabajoId" (selectionChange)="consultarTrabajoGrado()"
            placeholder="Seleccione un trabajo de grado">
            <mat-option value=0>Seleccionar</mat-option>
            <mat-option *ngFor="let trabajo of trabajosDirigidos" [value]="trabajo.TrabajoGrado.Id">
              {{ trabajo.TrabajoGrado.Titulo +
              ' (' + trabajo.TrabajoGrado.Modalidad.Nombre + ') - ' +
              'Rol: ' + trabajo.RolTrabajoGrado.Nombre }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </mat-card-content>
    </mat-card>

    <mat-card *ngIf="trabajoId > 0 && !mensaje">
      <app-versiones-documento [tiposDocumento]="tiposDocumento" [trabajoGradoId]="trabajoId">
      </app-versiones-documento>

      <div class="container-wrap">
        <mat-card class="container-documento">
          <mat-card-header>
            <mat-card-title>
              Documento Revisión
            </mat-card-title>
          </mat-card-header>
          <app-ver-documento *ngIf="doc" [enlace]="doc"></app-ver-documento>
        </mat-card>

        <mat-card class="container-documento">
          <mat-card-header>
            <mat-card-title>
              Revisiones
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <mat-accordion>
              <mat-expansion-panel *ngFor="let revision of revisionesTrabajoGrado">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    Revisión {{revision.NumeroRevision}} {{revision.EstadoRevisionTrabajoGrado.Nombre}}
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <p>
                  <cite>Fecha Revisión: {{revision.FechaRevision | date:'dd-MMM-yyyy'}} |
                    Fecha Recepción: {{revision.FechaRecepcion | date:'dd-MMM-yyyy'}}</cite>
                </p>

                <app-revisar-documento [autor]="nombreUsuario" [revision]="revision" [estadosRevisiones]="parametros" [tipoDocumentoId]="tipoDocumentoRevision"
                    *ngIf="revision.VinculacionTrabajoGrado.Usuario.toString() === documento &&
                    (revision.EstadoRevisionTrabajoGrado.CodigoAbreviacion === 'PENDIENTE_PLX' ||
                    revision.EstadoRevisionTrabajoGrado.CodigoAbreviacion === 'BORRADOR_PLX')">
                </app-revisar-documento>

                <app-ver-revision [revision]="revision" [autor]="nombreUsuario"
                  *ngIf="revision.EstadoRevisionTrabajoGrado.CodigoAbreviacion === 'FINALIZADA_PLX'">
                </app-ver-revision>
                <br>
              </mat-expansion-panel>
            </mat-accordion>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-card>

    <mat-card *ngIf="modo === 'ESTUDIANTE' && !mensaje">
      <mat-card-header>
        <mat-card-title>
          Acciones
        </mat-card-title>
      </mat-card-header>
      <mat-card-content class="flex-container-row">
        <mat-form-field class="form-field-container">
          <mat-label>Subir Nueva Versión</mat-label>
          <ngx-mat-file-input placeholder="{{'SELECCIONAR_ARCHIVO'}}" [(ngModel)]="nuevoDocumento" [accept]="'.pdf'">
          </ngx-mat-file-input>
        </mat-form-field>
        <mat-form-field class="form-field-container">
          <mat-label>Revisor</mat-label>
          <mat-select [(ngModel)]="revisorId" placeholder="Seleccione un el revisor para la solicitud">
            <mat-option value=0>Seleccionar</mat-option>
            <mat-option *ngFor="let revisor of vinculados" [value]="revisor.Id">
              {{ revisor.Nombre }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </mat-card-content>
      <mat-card-actions class="two-buttons-container">
        <button type="button" (click)="subirVersion()" [disabled]="!nuevoDocumento" mat-raised-button
          color="primary">NUEVA VERSIÓN</button>
        <button type="button" (click)="solicitarRevision()" [disabled]="!(revisorId > 0)" mat-raised-button
          color="primary">
          SOLICITAR REVISIÓN</button>
      </mat-card-actions>
    </mat-card>
  </mat-card-content>
</mat-card>
